<div class="accordion-item">
	<h2 class="accordion-header" id="headingResultadosPruebas">
		<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseResultadosPruebas" aria-expanded="true" aria-controls="collapseResultadosPruebas">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#000000" viewbox="0 0 256 256">
				<path d="M224,208H203.94A88.05,88.05,0,0,0,144,64.37V32a16,16,0,0,0-16-16H80A16,16,0,0,0,64,32V136a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V80.46A72,72,0,0,1,181.25,208H32a8,8,0,0,0,0,16H224a8,8,0,0,0,0-16Zm-96-72H80V32h48V136ZM72,184a8,8,0,0,1,0-16h64a8,8,0,0,1,0,16Z"></path>
			</svg>
			<strong class="mx-2">
				Resultados de Pruebas
			</strong>
		</button>
	</h2>
	<div id="collapseResultadosPruebas" class="accordion-collapse collapse" aria-labelledby="headingResultadosPruebas" data-bs-parent="#accordionExample">
		<div class="accordion-body">
			<a href="{{ path('resultados_pruebas_new', {'id': paciente.id}) }}" class="btn btn-primary">Añadir Resultado de Prueba</a>
			{% if data.resultados_pruebas is empty %}
				<p class="mt-3">Sin datos</p>
			{% else %}
				<table class="table table-hover table-borderless align-middle">
					<thead class="text-center">
							{% for prueba in data.resultados_pruebas %}
						<tr>
							<th>Nombre Prueba</th>
							<th>Fecha</th>

						</tr>
					</thead>
					<tbody class="text-center">
							<tr>
								<td>{{ prueba.nombrePrueba }}</td>
								<td>{{ prueba.fecha|date('d-m-Y') }}</td>
							</tr>
							<tr>
								<th>Resultado</th>
								<th>Acciones</th>
							</tr>
							<tr>
								<td>{{ prueba.resultado }}</td>
								<td>
									{% if prueba.archivo %}
										<a href="{{ path('ver_archivo', {'id': prueba.id}) }}" class="btn btn-info btn-sm mx-2" target="_blank">Ver Archivo</a>
										<form action="{{ path('resultados_pruebas_delete', {'id': prueba.id}) }}" method="post" class="delete-form" style="display:inline;">
											<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ prueba.id) }}">
											<button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal" data-id="{{ prueba.id }}">Eliminar</button>
										</form>
									{% else %}
										No Disponible
									{% endif %}
								</td>
							</tr>
                	{% if not loop.last %}
                    <tr>
                        <td colspan="2" class="table-separator"><hr></td>
                    </tr>
                	{% endif %}
            {% endfor %}
					</tbody>
				</table>
			{% endif %}

		</div>
	</div>
	<!-- Ventana modal de confirmación -->
	<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="deleteModalLabel">Confirmar eliminación</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					¿Estás seguro de que deseas eliminar este resultado de prueba?
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
					<button type="button" class="btn btn-danger" id="confirmDelete">Eliminar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Ventana modal de éxito -->
	<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="successModalLabel">Éxito</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					El resultado de la prueba ha sido eliminado exitosamente.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Ventana modal de error -->
	<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="errorModalLabel">Error</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					Ocurrió un error al intentar eliminar el resultado de la prueba.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Aceptar</button>
				</div>
			</div>
		</div>
	</div>

</div>
<script>
	document.addEventListener('DOMContentLoaded', function () {
let deleteForm;
let deleteModal = document.getElementById('deleteModal');
let confirmDeleteButton = document.getElementById('confirmDelete');

deleteModal.addEventListener('show.bs.modal', function (event) {
let button = event.relatedTarget;
let id = button.getAttribute('data-id');
deleteForm = document.querySelector(`form.delete-form[action$='${id}']`);
});

confirmDeleteButton.addEventListener('click', function () {
if (deleteForm) {
fetch(deleteForm.action, {
method: 'POST',
headers: {
'Content-Type': 'application/x-www-form-urlencoded'
},
body: new URLSearchParams(new FormData(deleteForm))
}).then(response => {
if (response.ok) {
return response.text();
} else {
throw new Error('Error al eliminar el resultado de la prueba.');
}
}).then(data => { // Cerrar la ventana modal de confirmación
let modal = bootstrap.Modal.getInstance(deleteModal);
modal.hide();

// Mostrar la ventana modal de éxito
let successModal = new bootstrap.Modal(document.getElementById('successModal'));
successModal.show();

// Recargar la página después de cerrar la ventana modal de éxito
successModal._element.addEventListener('hidden.bs.modal', function () {
location.reload();
});
}).catch(error => {
console.error('Error:', error);

// Mostrar la ventana modal de error
let errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
errorModal.show();
});
}
});
});
</script>
